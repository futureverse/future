<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Future for R: Future API Backend Specification • future</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Future for R: Future API Backend Specification">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">future</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.68.0-9037</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/future-1-overview.html">A Future for R: A Comprehensive Overview</a></li>
    <li><a class="dropdown-item" href="../articles/future-2-output.html">A Future for R: Text and Message Output</a></li>
    <li><a class="dropdown-item" href="../articles/future-2b-backend.html">A Future for R: Available Future Backends</a></li>
    <li><a class="dropdown-item" href="../articles/future-3-topologies.html">A Future for R: Future Topologies</a></li>
    <li><a class="dropdown-item" href="../articles/future-4-issues.html">A Future for R: Common Issues with Solutions</a></li>
    <li><a class="dropdown-item" href="../articles/future-4-non-exportable-objects.html">A Future for R: Non-Exportable Objects</a></li>
    <li><a class="dropdown-item" href="../articles/future-5-startup.html">A Future for R: Controlling Default Future Strategy</a></li>
    <li><a class="dropdown-item" href="../articles/future-6-future-api-backend-specification.html">A Future for R: Future API Backend Specification</a></li>
    <li><a class="dropdown-item" href="../articles/future-7-for-package-developers.html">A Future for R: Best Practices for Package Developers</a></li>
    <li><a class="dropdown-item" href="../articles/future-8-how-future-is-validated.html">A Future for R: How the Future Framework is Validated</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.futureverse.org/"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages">
<li><a class="external-link dropdown-item" href="https://doFuture.futureverse.org">doFuture (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://furrr.futureverse.org">furrr (map-reduce)</a></li>
    <li><a class="dropdown-item" href="https://future.futureverse.org">future</a></li>
    <li><a class="external-link dropdown-item" href="https://future.apply.futureverse.org">future.apply (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.batchtools.futureverse.org">future.batchtools (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.callr.futureverse.org">future.callr (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mirai.futureverse.org">future.mirai (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tests.futureverse.org">future.tests</a></li>
    <li><a class="external-link dropdown-item" href="https://globals.futureverse.org">globals</a></li>
    <li><a class="external-link dropdown-item" href="https://listenv.futureverse.org">listenv</a></li>
    <li><a class="external-link dropdown-item" href="https://parallelly.futureverse.org">parallelly</a></li>
    <li><a class="external-link dropdown-item" href="https://progressr.futureverse.org">progressr</a></li>
    <li><a class="external-link dropdown-item" href="https://BiocParallel.FutureParam.futureverse.org">BiocParallel.FutureParam (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tools.futureverse.org">future.tools (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mapreduce.futureverse.org">future.mapreduce (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://marshal.futureverse.org">marshal (experimental)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://cloud.r-project.org/package=future"><span class="fa fab fa-r-project"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/futureverse/future/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A Future for R: Future API Backend Specification</h1>
                        <h4 data-toc-skip class="author">Henrik
Bengtsson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/futureverse/future/blob/HEAD/vignettes/future-6-future-api-backend-specification.md.rsp" class="external-link"><code>vignettes/future-6-future-api-backend-specification.md.rsp</code></a></small>
      <div class="d-none name"><code>future-6-future-api-backend-specification.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="future-api-backend-specification">Future API Backend Specification<a class="anchor" aria-label="anchor" href="#future-api-backend-specification"></a>
</h2>
<p>Version 0.1.9-9000</p>
<p><em>WARNING: Starting with <strong>future</strong> 1.40.0
(2025-04-10), we are migrating to a new way to write future backends.
This is work in progress, so some of the below is subject to change for
the next few release cycles.</em></p>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This document is written to serve as a reference for developers who
are developing a future backend to the future framework as implemented
in the <strong><a href="https://future.futureverse.org">future</a></strong> package for R
that available on CRAN. The Future Application Programming Interface
(API) has three fundamental functions at its core:</p>
<ul>
<li><p><code>f &lt;- future(expr)</code> - create a future from an R
expression (non-blocking but may be blocking)</p></li>
<li><p><code>r &lt;- resolved(f)</code> - check whether a future is
resolved or not (non-blocking)</p></li>
<li><p><code>v &lt;- value(f)</code> - retrieve the value of a future
(blocking)</p></li>
</ul>
<p>With these three functions alone, it is possible to evaluate one or
more R expressions synchronously and asynchronously. How and where these
expressions are resolved depends on which “future backend” is in use.
For example, one backend may evaluated the expressions sequentially
(synchronously) while another may evaluated them in parallel
(asynchronously). Regardless of backend, the value of a future
expression is always the same.</p>
<p>It is fundamental to the future ecosystem that all future backends
conform to the Future API specification. Conformance serves as a
guarantor of correctness and behavior for both the developer who use
futures in their software as well as the end-user of their software. A
future backend that meets the requirements can be used in any software
that use futures internally.</p>
<p>For example, the above three functions serve as building blocks in
several higher-level map-reduce APIs. One example is the <strong><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></strong>
package on CRAN that provides <code><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_lapply()</a></code>, which is a
futurized version of <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> available in the
<strong>base</strong> package. This function can be used to perform the
lapply-like processing in parallel using a parallel backend. The
implementation of the <strong>future.apply</strong> package is 100%
invariant to the parallel backend used. This is possible because all
future backends conform to a set of rules. Rules that are documented
below.</p>
<p>A supplement to the specification herein is the ‘Test Suite for
Future API Backends’, which consists of a set of tests that can be used
to validated that a future backend meets the minimal requirements of the
Future API. These tests run from the command-line, from the R prompt, or
as part of the package tests of a backend package. This test suite is
documented and implemented in the <strong><a href="https://future.tests.futureverse.org" class="external-link">future.tests</a></strong>
package available on CRAN.</p>
</div>
<div class="section level3">
<h3 id="feedback">Feedback<a class="anchor" aria-label="anchor" href="#feedback"></a>
</h3>
<p>If you find that something in this document to be missing, unclear,
or faulty, please report your feedback using the official issue tracker
for the <strong>future</strong> package at <a href="https://github.com/futureverse/future" class="external-link uri">https://github.com/futureverse/future</a>. If you have
feedback that is specific to the test suite, please use the official
issue tracker for the <strong>future.tests</strong> package at <a href="https://github.com/futureverse/future.tests" class="external-link uri">https://github.com/futureverse/future.tests</a>.</p>
</div>
<div class="section level3">
<h3 id="overview-of-the-future-api">Overview of the Future API<a class="anchor" aria-label="anchor" href="#overview-of-the-future-api"></a>
</h3>
<p>The Future API has three fundamental functions at its core:</p>
<ul>
<li><p><code>f &lt;- future(expr)</code> - create a future from an R
expression (non-blocking but may be blocking)</p></li>
<li><p><code>r &lt;- resolved(f)</code> - check whether a future is
resolved or not (non-blocking)</p></li>
<li><p><code>v &lt;- value(f)</code> - retrieve the value of a future
(blocking)</p></li>
</ul>
<p>The implementation of a future backend for these involves several
steps. For simplicity, lets say we call our future backend ‘myparallel’.
As a broad summary, a future backend needs to implement the following
components:</p>
<ul>
<li><p>A <code>myparallel</code> function that inherits class
<code>future</code>. This function must never be called - it is used as
a no-op placeholder for setting the future backend via
<code><a href="../reference/plan.html">plan()</a></code>.</p></li>
<li><p>A <code>MyParallelFutureBackend</code> function that returns and
an object of class <code>MyParallelFutureBackend</code> inheriting the
<code>FutureBackend</code>. This function should be set as attribute
<code>factory</code> for the above <code>myparallel</code>
function.</p></li>
<li><p>A <code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code> method for the
<code>MyParallelFutureBackend</code> class taking arguments
<code>backend</code> and <code>future</code>. This method is responsible
for starting the concurrent evaluation of the <code>Future</code> object
and returning it as an instance of class <code>MyParallelFuture</code>
inheriting the <code>Future</code> class. This method is often
non-blocking for parallel backends, but may be blocking if all compute
resources are exhausted. It is typically blocking for sequential
backends.</p></li>
<li><p>An S3 method of <code><a href="../reference/resolved.html">resolved()</a></code> for
<code>MyParallelFuture</code> that, in a non-blocking fashion, returns
<code>TRUE</code> if the future is resolved and <code>FALSE</code> if
not.</p></li>
<li><p>An S3 method of <code><a href="../reference/result.html">result()</a></code> for
<code>MyParallelFuture</code> that returns a <code>FutureResult</code>
object (as defined by the <strong><a href="https://future.futureverse.org">future</a></strong> package) when
the future is resolved or otherwise fails to resolve. If the future is
not yet resolved, this method should block until the future is
resolved.</p></li>
</ul>
<p>With this in place, the selection of using this backend as the future
plan, will be done as <code>plan(myparallel)</code> with the option of
specifying certain arguments to be passed to <code>myparallel()</code>.
With the plan set, a call to <code>f &lt;- future(expr)</code> will then
launch the evaluation of the future via the <code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code>
method for the current set future backend and return then launch the
future now inheriting <code>MyParallelFuture</code>. When calling
<code>resolved(f)</code> to query whether the future expression is
resolved or not, the underlying S3 method for this class will then check
in with the parallel worker whether the expression is resolved or not.
When calling <code>value(f)</code>, the S3 method for the
<code>Future</code> class calls <code>result(f)</code>, which will
return the <code>FutureResult</code> object for this future. If the
future is not yet resolved, this call will block until it is. If no
errors occurred while resolving the future expression, then
<code>value(f)</code> will return the value of the expression, which is
recorded by the backend in the <code>FutureResult</code> object. If
there was an evaluation error, then <code>value(f)</code> will resignal
(“relayed”) that error. Any captured conditions or standard output will
also be relayed at this point.</p>
</div>
<div class="section level3">
<h3 id="requirements-for-the-backend-future-api">Requirements for the backend Future API<a class="anchor" aria-label="anchor" href="#requirements-for-the-backend-future-api"></a>
</h3>
<p>This section describes in detail what the requirements of the above
four components are. The requirements are given as a continuation of the
above ‘myparallel’ example. If otherwise not specified, all functions
mentioned below are from the <strong><a href="https://future.futureverse.org">future</a></strong> package.</p>
<div class="section level4">
<h4 id="constructor-function-creating-a-future">Constructor function creating a Future<a class="anchor" aria-label="anchor" href="#constructor-function-creating-a-future"></a>
</h4>
<p>The place-holder function <code>myparallel()</code> that is used by
<code><a href="../reference/plan.html">plan()</a></code> must inherits from class <code>future</code> such
that <code>inherits(myparallel, "future")</code> is true. It must also
have attribute <code>factory</code> set to the corresponding
<code>FutureBackend</code> function,
i.e. <code>MyParallelFutureBackend</code>.</p>
</div>
<div class="section level4">
<h4 id="launchfuture-method-of-the-futurebackend-class">launchFuture() method of the FutureBackend class<a class="anchor" aria-label="anchor" href="#launchfuture-method-of-the-futurebackend-class"></a>
</h4>
<p>An S3 method <code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code> for
<code>MyParallelFutureBackend</code> that takes a
<code>FutureBackend</code> object as its first argument and a
<code>Future</code> object as the second is required. It should accept
additional arguments via <code>...</code>, which are currently not
used.</p>
<p>The <code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code> method should invisibly return the
<code>Future</code> object of desired class,
e.g. <code>MyParallelFuture</code>.</p>
<p>The <code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code> method is responsible for evaluation
the <code>Future</code> object. The evaluation of the future expression
should respect any global variables in the <code>FutureGlobals</code>
object returned by <code>globals()</code> with the <code>Future</code>
object as the first argument. The evaluation should also respect any
package names returned by <code>packages()</code> with the
<code>Future</code> object as the first argument.</p>
<p>If the backend provides parallel processing, then
<code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code> should return the future as soon as possible
and without waiting for it to be resolved. If all workers are occupied,
then <code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code> is responsible for waiting until a
worker becomes available and then launch the future on that worker and
immediatedly return the future.</p>
<p>The <code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code> method may produce an error of class
<code>FutureError</code> in case it fails to launch the future on the
worker or the worker has terminated unexpectedly.</p>
<p>The <code><a href="../reference/FutureBackend-class.html">launchFuture()</a></code> method must not update the RNG
state.</p>
</div>
<div class="section level4">
<h4 id="resolved-method-for-the-future-class">resolved() method for the Future class<a class="anchor" aria-label="anchor" href="#resolved-method-for-the-future-class"></a>
</h4>
<p>An S3 method <code><a href="../reference/resolved.html">resolved()</a></code> for
<code>MyParallelFuture</code> that takes a <code>Future</code> object as
its first argument and return either <code>TRUE</code> or
<code>FALSE</code> is required. It should accept additional arguments
via <code>...</code>, which are currently not used.</p>
<p>The method may be called zero or more times.</p>
<p>The method should return <code>FALSE</code> as long as the future is
unresolved. It may also return <code>FALSE</code> if it fail to
establish the state of the future within a reasonable time period
(“timeout”). It should return <code>TRUE</code> as soon as it can be
established that the future is resolved. After it has returned
<code>TRUE</code> once, any succeeding calls should return
<code>TRUE</code>.</p>
<p>If <code><a href="../reference/resolved.html">resolved()</a></code> is called on a future that yet has not
been launched, it should launch the future by calling
<code><a href="../reference/run.html">run()</a></code>. This is the only occasion when
<code><a href="../reference/resolved.html">resolved()</a></code> may block. In all other cases, it should return
promptly.</p>
<p>The <code><a href="../reference/resolved.html">resolved()</a></code> method may produce
<code>FutureError</code> error as created by <code><a href="../reference/FutureCondition.html">FutureError()</a></code>
in case communication with the worker has broken down or the worker has
terminated unexpectedly.</p>
<p>The <code><a href="../reference/resolved.html">resolved()</a></code> method must not update the RNG state.</p>
</div>
<div class="section level4">
<h4 id="result-method-for-the-future-class">result() method for the Future class<a class="anchor" aria-label="anchor" href="#result-method-for-the-future-class"></a>
</h4>
<p>An S3 method <code><a href="../reference/result.html">result()</a></code> for <code>MyParallelFuture</code>
that takes a <code>Future</code> object as its first argument and return
a <code>FutureResult</code> object is required. It should accept
additional arguments via <code>...</code>, which are currently not
used.</p>
<p>The method may be called zero or more times.</p>
<p>If <code><a href="../reference/result.html">result()</a></code> is called on a future that yet has not been
launched, it should launch the future by calling <code><a href="../reference/run.html">run()</a></code>.</p>
<p>If <code><a href="../reference/result.html">result()</a></code> is called on a future that is not yet
resolved, it should block until the future is resolved.</p>
<p>The value of <code><a href="../reference/result.html">result()</a></code> should be the value from
evaluating the <code><a href="../reference/getExpression.html">getExpression()</a></code> expression that
<code><a href="../reference/run.html">run()</a></code> launched.</p>
<p>The <code><a href="../reference/result.html">result()</a></code> method may produce <code>FutureError</code>
error as created by <code><a href="../reference/FutureCondition.html">FutureError()</a></code> in case communication
with the worker has broken down or the worker has terminated
unexpectedly.</p>
<p>The <code><a href="../reference/result.html">result()</a></code> method must not update the RNG state.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9007.</p>
</div>

    </footer>
</div>





  </body>
</html>
